<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenChess Board</title>
    <link rel="stylesheet" href="/spa.css">
    <!-- cm-chessboard CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cm-chessboard@8.11.0/assets/chessboard.css">
</head>
<body>
    <!-- Navigation -->
    <nav id="nav" style="display: none;">
        <button onclick="router.navigate('/')">Config</button>
        <button onclick="router.navigate('/game')">Game Selection</button>
        <button onclick="router.navigate('/board-view')">Board View</button>
        <button onclick="router.navigate('/board-edit')">Board Edit</button>
    </nav>

    <!-- Config View -->
    <div id="view-config" class="view" style="display: none;">
        <div class="container">
            <h2>OPENCHESSBOARD CONFIGURATION</h2>
            <form id="config-form">
                <div class="form-group">
                    <label for="ssid">WiFi SSID:</label>
                    <input type="text" name="ssid" id="ssid" placeholder="Enter Your WiFi SSID">
                </div>
                <div class="form-group">
                    <label for="password">WiFi Password:</label>
                    <input type="password" name="password" id="password" placeholder="Enter Your WiFi Password">
                </div>
                <div class="form-group">
                    <label for="token">Lichess Token (Optional):</label>
                    <input type="text" name="token" id="token" placeholder="Enter Your Lichess Token (Future Feature)">
                </div>
                <div class="form-group">
                    <label for="gameMode">Default Game Mode:</label>
                    <select name="gameMode" id="gameMode">
                        <option value="None">Local Chess Only</option>
                        <option value="5+3">5+3 (Future)</option>
                        <option value="10+5">10+5 (Future)</option>
                        <option value="15+10">15+10 (Future)</option>
                        <option value="AI level 1">AI level 1 (Future)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="startupType">Startup Type:</label>
                    <select name="startupType" id="startupType">
                        <option value="AP">Access Point Mode</option>
                        <option value="Station">Station Mode</option>
                    </select>
                </div>
                <button type="submit" class="button">Save Configuration</button>
            </form>
            <div id="config-status" class="status"></div>
        </div>
    </div>

    <!-- Game Selection View -->
    <div id="view-game" class="view" style="display: none;">
        <div class="game-selection-container">
            <div class="player-selection">
                <h3>Select White Player</h3>
                <div class="player-options">
                    <div class="player-option" onclick="selectPlayer('white', 0)">
                        <span class="player-icon">ðŸ‘¤</span>
                        <span class="player-label">Human</span>
                    </div>
                    <div class="player-option" onclick="selectPlayer('white', 1)">
                        <span class="player-icon">ðŸ¤–</span>
                        <span class="player-label">Easy AI</span>
                    </div>
                    <div class="player-option" onclick="selectPlayer('white', 2)">
                        <span class="player-icon">ðŸ¤–</span>
                        <span class="player-label">Medium AI</span>
                    </div>
                    <div class="player-option" onclick="selectPlayer('white', 3)">
                        <span class="player-icon">ðŸ¤–</span>
                        <span class="player-label">Hard AI</span>
                    </div>
                </div>
            </div>
            <div class="player-selection">
                <h3>Select Black Player</h3>
                <div class="player-options">
                    <div class="player-option" onclick="selectPlayer('black', 0)">
                        <span class="player-icon">ðŸ‘¤</span>
                        <span class="player-label">Human</span>
                    </div>
                    <div class="player-option" onclick="selectPlayer('black', 1)">
                        <span class="player-icon">ðŸ¤–</span>
                        <span class="player-label">Easy AI</span>
                    </div>
                    <div class="player-option" onclick="selectPlayer('black', 2)">
                        <span class="player-icon">ðŸ¤–</span>
                        <span class="player-label">Medium AI</span>
                    </div>
                    <div class="player-option" onclick="selectPlayer('black', 3)">
                        <span class="player-icon">ðŸ¤–</span>
                        <span class="player-label">Hard AI</span>
                    </div>
                </div>
            </div>
            <div class="start-game-container">
                <button id="start-game-btn" class="start-game-button" onclick="startGame()" disabled>Start Game</button>
            </div>
            <div class="sensor-test-container">
                <button class="sensor-test-button" onclick="selectSensorTest()">Sensor Test</button>
            </div>
        </div>
    </div>

    <!-- Board View -->
    <div id="view-board-view" class="view" style="display: none;">
        <div class="container">
            <h2>CHESS BOARD</h2>
            <div id="board-status" class="status">Loading board state...</div>
            <div id="board-container" class="board-container" style="display: none;">
                <div class="board" id="chess-board">
                    <!-- Board squares will be generated by JavaScript -->
                </div>
            </div>
            <div id="no-board-message" style="display: none; text-align: center; color: #ec8703;">
                <p>No active game detected. Start a game to view the board.</p>
            </div>
            <div class="info">
                <p>Auto-refreshing every 2 seconds</p>
                <div id="evaluation" style="margin-top: 15px; padding: 15px; background-color: #444; border-radius: 5px;">
                    <div style="text-align: center; margin-bottom: 10px; color: #ec8703; font-weight: bold;">Stockfish Evaluation</div>
                    <div style="position: relative; width: 100%; height: 40px; background-color: #333; border: 2px solid #555; border-radius: 5px; overflow: hidden;">
                        <div id="eval-bar" style="position: absolute; top: 0; left: 50%; width: 0%; height: 100%; background: linear-gradient(to right, #F44336 0%, #F44336 50%, #4CAF50 50%, #4CAF50 100%); transition: width 0.3s ease, left 0.3s ease;"></div>
                        <div style="position: absolute; top: 0; left: 50%; width: 2px; height: 100%; background-color: #ec8703; z-index: 2;"></div>
                        <div id="eval-arrow" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 24px; z-index: 3; color: #ec8703; transition: left 0.3s ease;">â¬Œ</div>
                    </div>
                    <div id="eval-text" style="text-align: center; margin-top: 10px; font-size: 14px; color: #ec8703;">--</div>
                </div>
                <div id="pgn-section" style="margin-top: 20px; padding: 15px; background-color: #444; border-radius: 5px; display: none;">
                    <div style="text-align: center; margin-bottom: 10px; color: #ec8703; font-weight: bold;">Game Notation (PGN)</div>
                    <div id="pgn-display" style="color: #fff; font-family: monospace; font-size: 14px; line-height: 1.6; word-wrap: break-word; max-height: 200px; overflow-y: auto; padding: 10px; background-color: #333; border-radius: 3px;"></div>
                </div>
                <div id="fen-section" style="margin-top: 20px; padding: 15px; background-color: #444; border-radius: 5px; display: none;">
                    <div style="text-align: center; margin-bottom: 10px; color: #ec8703; font-weight: bold;">FEN (Forsyth-Edwards Notation)</div>
                    <div id="fen-display" style="color: #fff; font-family: monospace; font-size: 12px; line-height: 1.6; word-wrap: break-word; padding: 10px; background-color: #333; border-radius: 3px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Board Edit View -->
    <div id="view-board-edit" class="view" style="display: none;">
        <div class="container">
            <h2>EDIT CHESS BOARD</h2>
            <div class="status" id="edit-status">Click on any square to change the piece. Empty = no piece.</div>
            <div id="edit-board-container" class="board-container">
                <form id="boardForm">
                    <div class="board" id="edit-chess-board">
                        <!-- Board squares will be generated by JavaScript -->
                    </div>
                    <div class="controls">
                        <button type="button" class="button" onclick="saveBoard()">Save Board State</button>
                        <button type="button" class="button secondary" onclick="resetBoard()">Reset</button>
                        <button type="button" id="pause-toggle" class="button secondary">Pause Move Detection</button>
                        <button type="button" id="undo-button" class="button secondary" style="display: none;">Undo Last Move</button>
                    </div>
                </form>
            </div>
            <div class="info">
                <p>Changes will be applied to the current game state.</p>
            </div>
        </div>
    </div>

    <script src="/spa.js"></script>
    <!-- cm-chessboard - load as module after main script -->
    <script type="module">
        // Load cm-chessboard dynamically
        import('https://cdn.jsdelivr.net/npm/cm-chessboard@8.11.0/src/Chessboard.js').then(module => {
            window.Chessboard = module.Chessboard;
            window.COLOR = module.COLOR;
            window.BORDER_TYPE = module.BORDER_TYPE;
            return import('https://cdn.jsdelivr.net/npm/cm-chessboard@8.11.0/src/model/Position.js');
        }).then(module => {
            window.FEN = module.FEN;
            console.log('cm-chessboard modules loaded');
            // Reinitialize board view if it was already initialized
            if (typeof initBoardView === 'function') {
                const boardEl = document.getElementById('chess-board');
                if (boardEl && boardEl.parentElement) {
                    // Board view might need reinitialization
                }
            }
        }).catch(error => {
            console.warn('Failed to load cm-chessboard:', error);
        });
    </script>
</body>
</html>

